<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Administration Proxy</title>

        <style>
            html {
                padding-left: 20%;
                padding-right: 20%;
                background-color: rgb(30, 30, 30);
                font: 1.2em "Fira Sans", sans-serif;
            }

            h1 {
                padding: 10px;
                border-radius: 5px;
                background-color: aquamarine;
            }

            .formulaire {
                display: flex;
                flex-direction: column;
                border-radius: 5px;
                background-color: white;
                margin-top: 10px;
                padding: 20px;
            }

            .line {
                margin-top: 10px;
                margin-bottom: 10px;
                display: flex;
                flex-direction: row;
            }

            .info {
                padding: 10px;
                border-radius: 10px;
                margin-right: 20px;
                background-color: greenyellow;
            }

            label {
                padding-top: 5px;
                padding-left: 10px;
                padding-right: 10px;
                border-radius: 10px;
                margin-right: 20px;
                background-color: orange;
            }

            input {
                border: 1px solid lightblue;
                border-radius: 5px;
                width: 200px;
                height: 30px;
            }

            button {
                margin-left: 25%;
                margin-right: 25%;
                font-size: 24px;
                font-weight: bold;
                margin-top: 10px;
                padding: 0px;
                border: none;
                background-color: yellow;
                border-radius: 5px;
                width: 400px;
                height: 70px;
            }

            button:hover {
                background-color: goldenrod;
                cursor: pointer;
            }
        </style>

    </head>

    <body>
        <h1>Configuration du proxy</h1>

        <div class="formulaire">
            <!-- Port -->
            <div class="line">
                <label>Port </label> 
                <input id="configuration_port" type="number" value="{{configuration_port}}"\>
            </div>
        </div>

        <h1>Filtrage</h1>

        <div class="formulaire">
            <!-- Mot à remplacer -->
            <div class="info">(!) Format : mot_à_replacer,mot_de_remplacement,...</div>
            <div class="line">
                <label>Texte à remplacer</label> 
                <textarea id="configuration_words_to_replace" rows="5" cols="60" value="{{configuration_words_to_replace}}"></textarea>
            </div>
        </div>

        <h1>Blacklist</h1>

        <div class="formulaire">
            <!-- Url à bloquer -->
            <div class="info">(!) Format : url1,url2,...</div>
            <div class="line">
                <label>Url à bloquer</label> 
                <textarea id="configuration_url_blacklist" rows="5" cols="60" value="{{configuration_url_blacklist}}"></textarea>
            </div>

            <!-- Ressource à bloquer -->
            <div class="info">(!) Format : resources1,resources2,...</div>
            <div class="line">
                <label>Ressource à bloquer</label> 
                <textarea id="configuration_resources_blacklist" rows="5" cols="60" value="{{configuration_resources_blacklist}}"></textarea>
            </div>
        </div>

        <!-- Bouton d'envoi de configuration -->
        <h1></h1>
        <button id="submit">Mettre à jour</button>

        <script>
            var configuration_text = "";

            document.querySelector("#submit").addEventListener("click", function()
            {
                configuration_text = "";
                
                let configuration_port = document.querySelector("#configuration_port").value;
                let configuration_words_to_replace = document.querySelector("#configuration_words_to_replace").value;
                let configuration_url_blacklist = document.querySelector("#configuration_url_blacklist").value;
                let configuration_resources_blacklist = document.querySelector("#configuration_resources_blacklist").value;

                configuration_text += "port:" + configuration_port + "\n";
                configuration_text += "words_to_replace:" + configuration_words_to_replace + "\n";
                configuration_text += "url_blacklist:" + configuration_url_blacklist + "\n";
                configuration_text += "resources_blacklist:" + configuration_resources_blacklist + "\n";

                let form_data = new FormData();
                form_data.append("configuration", configuration_text);

                fetch("http://localhost:" + configuration_port + "/proxy", {
                    method: 'POST',
                    headers: {
                        'Accept': 'text/html'
                    },
                    body: form_data
                }).then(function (result) {
                    return result.json();
                }).then(function (result) {
                    console.log(result);
                });
            });
        </script>

    </body>

</html>